// ----------------------------------------------------------------------------
// Buzz, a Javascript HTML5 Audio library
// v 1.0.4 beta
// Licensed under the MIT license.
// http://buzz.jaysalvat.com/
// ----------------------------------------------------------------------------
// Copyright (C) 2011 Jay Salvat
// http://jaysalvat.com/
// ----------------------------------------------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files ( the "Software" ), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// ----------------------------------------------------------------------------
var buzz={defaults:{autoplay:false,duration:5000,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(a,o){o=o||{};var h=0,n=[],c={},b=buzz.isSupported();this.load=function(){if(!b){return this}this.sound.load();return this};this.play=function(){if(!b){return this}this.sound.play();return this};this.togglePlay=function(){if(!b){return this}if(this.sound.paused){this.sound.play()}else{this.sound.pause()}return this};this.pause=function(){if(!b){return this}this.sound.pause();return this};this.isPaused=function(){if(!b){return null}return this.sound.paused};this.stop=function(){if(!b){return this}this.setTime(this.getDuration());this.sound.pause();return this};this.isEnded=function(){if(!b){return null}return this.sound.ended};this.loop=function(){if(!b){return this}this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!b){return this}this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!b){return this}this.sound.muted=true;return this};this.unmute=function(){if(!b){return this}this.sound.muted=false;return this};this.toggleMute=function(){if(!b){return this}this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){if(!b){return null}return this.sound.muted};this.setVolume=function(i){if(!b){return this}if(i<0){i=0}if(i>100){i=100}this.volume=i;this.sound.volume=i/100;return this};this.getVolume=function(){if(!b){return this}return this.volume};this.increaseVolume=function(i){return this.setVolume(this.volume+(i||1))};this.decreaseVolume=function(i){return this.setVolume(this.volume-(i||1))};this.setTime=function(i){if(!b){return this}this.whenReady(function(){this.sound.currentTime=i});return this};this.getTime=function(){if(!b){return null}var i=Math.round(this.sound.currentTime*100)/100;return isNaN(i)?buzz.defaults.placeholder:i};this.setPercent=function(i){if(!b){return this}return this.setTime(buzz.fromPercent(i,this.sound.duration))};this.getPercent=function(){if(!b){return null}var i=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(i)?buzz.defaults.placeholder:i};this.setSpeed=function(i){if(!b){return this}this.sound.playbackRate=i};this.getSpeed=function(){if(!b){return null}return this.sound.playbackRate};this.getDuration=function(){if(!b){return null}var i=Math.round(this.sound.duration*100)/100;return isNaN(i)?buzz.defaults.placeholder:i};this.getPlayed=function(){if(!b){return null}return m(this.sound.played)};this.getBuffered=function(){if(!b){return null}return m(this.sound.buffered)};this.getSeekable=function(){if(!b){return null}return m(this.sound.seekable)};this.getErrorCode=function(){if(b&&this.sound.error){return this.sound.error.code}return 0};this.getErrorMessage=function(){if(!b){return null}switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){if(!b){return null}return this.sound.readyState};this.getStateMessage=function(){if(!b){return null}switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!b){return null}return this.sound.networkState};this.getNetworkStateMessage=function(){if(!b){return null}switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(i,j){if(!b){return this}this.sound[i]=j;return this};this.get=function(i){if(!b){return null}return i?this.sound[i]:this.sound};this.bind=function(k,r){if(!b){return this}k=k.split(" ");var q=this,s=function(t){r.call(q,t)};for(var j=0;j<k.length;j++){var p=k[j],i=p;p=i.split(".")[0];n.push({idx:i,func:s});this.sound.addEventListener(p,s,true)}return this};this.unbind=function(q){if(!b){return this}q=q.split(" ");for(var p=0;p<q.length;p++){var j=q[p],s=j.split(".")[0];for(var k=0;k<n.length;k++){var r=n[k].idx.split(".");if(n[k].idx==j||(r[1]&&r[1]==j.replace(".",""))){this.sound.removeEventListener(s,n[k].func,true);delete n[k]}}}return this};this.bindOnce=function(i,k){if(!b){return this}var j=this;c[h++]=false;this.bind(h+i,function(){if(!c[h]){c[h]=true;k.call(j)}j.unbind(h+i)})};this.trigger=function(s){if(!b){return this}s=s.split(" ");for(var r=0;r<s.length;r++){var j=s[r];for(var q=0;q<n.length;q++){var p=n[q].idx.split(".");if(n[q].idx==j||(p[0]&&p[0]==j.replace(".",""))){var k=document.createEvent("HTMLEvents");k.initEvent(p[0],false,true);this.sound.dispatchEvent(k)}}}return this};this.fadeTo=function(s,p,r){if(!b){return this}if(p instanceof Function){r=p;p=buzz.defaults.duration}else{p=p||buzz.defaults.duration}var q=this.volume,j=p/Math.abs(q-s),k=this;this.play();function i(){setTimeout(function(){if(q<s&&k.volume<s){k.setVolume(k.volume+=1);i()}else{if(q>s&&k.volume>s){k.setVolume(k.volume-=1);i()}else{if(r instanceof Function){r.apply(k)}}}},j)}this.whenReady(function(){i()});return this};this.fadeIn=function(i,j){if(!b){return this}return this.setVolume(0).fadeTo(100,i,j)};this.fadeOut=function(i,j){if(!b){return this}return this.fadeTo(0,i,j)};this.fadeWith=function(j,i){if(!b){return this}this.fadeOut(i,function(){this.stop()});j.play().fadeIn(i);return this};this.whenReady=function(j){if(!b){return null}var i=this;if(this.sound.readyState===0){this.bind("canplay.buzzwhenready",function(){j.call(i)})}else{j.call(i)}};function m(j){var q=[],p=j.length-1;for(var k=0;k<=p;k++){q.push({start:j.start(p),end:j.end(p)})}return q}function l(i){return i.split(".").pop()}function e(j,k){var i=document.createElement("source");i.src=k;if(buzz.types[l(k)]){i.type=buzz.types[l(k)]}j.appendChild(i)}if(b){for(var g in buzz.defaults){if(buzz.defaults.hasOwnProperty(g)){o[g]=o[g]||buzz.defaults[g]}}this.sound=document.createElement("audio");if(a instanceof Array){for(var f in a){if(a.hasOwnProperty(f)){e(this.sound,a[f])}}}else{if(o.formats.length){for(var d in o.formats){if(o.formats.hasOwnProperty(d)){e(this.sound,a+"."+o.formats[d])}}}else{e(this.sound,a)}}if(o.loop){this.loop()}if(o.autoplay){this.sound.autoplay="autoplay"}if(o.preload===true){this.sound.preload="auto"}else{if(o.preload===false){this.sound.preload="none"}else{this.sound.preload=o.preload}}this.setVolume(o.volume);buzz.sounds.push(this)}},group:function(a){a=c(a,arguments);this.getSounds=function(){return a};this.add=function(e){e=c(e,arguments);for(var d=0;d<e.length;d++){a.push(e[d])}};this.remove=function(f){f=c(f,arguments);for(var d=0;d<f.length;d++){for(var e=0;e<a.length;e++){if(a[e]==f[d]){delete a[e];break}}}};this.load=function(){b("load");return this};this.play=function(){b("play");return this};this.togglePlay=function(){b("togglePlay");return this};this.pause=function(d){b("pause",d);return this};this.stop=function(){b("stop");return this};this.mute=function(){b("mute");return this};this.unmute=function(){b("unmute");return this};this.toggleMute=function(){b("toggleMute");return this};this.setVolume=function(d){b("setVolume",d);return this};this.increaseVolume=function(d){b("increaseVolume",d);return this};this.decreaseVolume=function(d){b("decreaseVolume",d);return this};this.loop=function(){b("loop");return this};this.unloop=function(){b("unloop");return this};this.setTime=function(d){b("setTime",d);return this};this.setduration=function(d){b("setduration",d);return this};this.set=function(d,e){b("set",d,e);return this};this.bind=function(d,e){b("bind",d,e);return this};this.unbind=function(d){b("unbind",d);return this};this.bindOnce=function(d,e){b("bindOnce",d,e);return this};this.trigger=function(d){b("trigger",d);return this};this.fade=function(g,f,d,e){b("fade",g,f,d,e);return this};this.fadeIn=function(d,e){b("fadeIn",d,e);return this};this.fadeOut=function(d,e){b("fadeOut",d,e);return this};function b(){var d=c(null,arguments),f=d.shift();for(var e=0;e<a.length;e++){a[e][f].apply(a[e],d)}}function c(e,d){return(e instanceof Array)?e:Array.prototype.slice.call(d)}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return !!buzz.el.canPlayType},isOGGSupported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return !!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(e,b){var d,a,c;d=Math.floor(e/3600);d=isNaN(d)?"--":(d>=10)?d:"0"+d;a=b?Math.floor(e/60%60):Math.floor(e/60);a=isNaN(a)?"--":(a>=10)?a:"0"+a;c=Math.floor(e%60);c=isNaN(c)?"--":(c>=10)?c:"0"+c;return b?d+":"+a+":"+c:a+":"+c},fromTimer:function(b){var a=b.toString().split(":");if(a&&a.length==3){b=(parseInt(a[0],10)*3600)+(parseInt(a[1],10)*60)+parseInt(a[2],10)}if(a&&a.length==2){b=(parseInt(a[0],10)*60)+parseInt(a[1],10)}return b},toPercent:function(d,c,a){var b=Math.pow(10,a||0);return Math.round(((d*100)/c)*b)/b},fromPercent:function(d,c,a){var b=Math.pow(10,a||0);return Math.round(((c/100)*d)*b)/b}};